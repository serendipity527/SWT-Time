DWT Prompt Generator 性能分析套件
================================================================================
开始全面性能测试...

================================================================================
测试1: 时间复杂度分析
================================================================================

1.1 不同序列长度的性能 (固定 batch_size=4, n_vars=7)
序列长度         平均时间(ms)        标准差          吞吐量(样本/s)      
----------------------------------------------------------------------
128          4.90            6.29         817.0          
256          3.37            5.66         1185.9         
512          1.71            0.03         2337.0         
1024         1.77            0.05         2254.8         
2048         4.07            3.69         983.6          
4096         2.27            0.35         1764.6         

1.2 不同批次大小的性能 (固定 seq_len=512, n_vars=7)
批次大小         平均时间(ms)        标准差          吞吐量(样本/s)      
----------------------------------------------------------------------
1            10.85           7.03         92.2           
2            1.69            0.03         1182.4         
4            1.73            0.02         2314.8         
8            1.82            0.03         4393.3         
16           2.02            0.03         7930.8         
32           2.45            0.30         13049.7        
64           3.61            3.59         17718.0        

1.3 不同变量数的性能 (固定 batch_size=4, seq_len=512)
变量数          平均时间(ms)        标准差          吞吐量(样本/s)      
----------------------------------------------------------------------
1            10.23           1.55         391.1          
3            1.68            0.03         2387.7         
7            2.35            1.74         1701.4         
14           1.99            0.81         2007.0         
21           1.77            0.16         2256.2         
28           1.69            0.11         2373.6         

✅ 时间复杂度分析完成!

================================================================================
测试2: 空间复杂度分析
================================================================================

2.1 不同序列长度的内存使用
序列长度         峰值内存(MB)        当前内存(MB)       
--------------------------------------------------
128          0.00            0.00           
256          0.00            0.00           
512          0.00            0.00           
1024         0.00            0.00           
2048         0.00            0.00           
4096         0.00            0.00           

2.2 不同批次大小的内存使用
批次大小         峰值内存(MB)        当前内存(MB)       
--------------------------------------------------
1            0.00            0.00           
4            0.00            0.00           
8            0.00            0.00           
16           0.00            0.00           
32           0.00            0.00           
64           0.00            0.00           

✅ 空间复杂度分析完成!

================================================================================
测试3: 不同配置的性能对比
================================================================================

3.1 不同小波基的性能对比
小波基          平均时间(ms)        标准差         
--------------------------------------------------
db1          1.74            0.03        
db4          1.76            0.02        
db8          1.78            0.02        
sym4         1.78            0.05        
coif2        1.78            0.03        

3.2 不同分解层数的性能对比
分解层数         平均时间(ms)        标准差         
--------------------------------------------------
1            1.76            2.67        
2            1.52            0.12        
3            1.85            0.07        
4            2.15            0.04        
5            2.51            0.40        

3.3 不同压缩级别的Prompt生成性能
压缩级别         平均时间(ms)        Token数      
--------------------------------------------------
minimal      0.01            21          
balanced     0.01            48          
detailed     0.01            69          

✅ 配置对比测试完成!

================================================================================
测试4: GPU vs CPU性能对比
================================================================================

4.1 不同批次大小的GPU加速比
批次大小         CPU(ms)      GPU(ms)      加速比         
------------------------------------------------------------
1            4.43         2.26         1.96        x
4            1.67         1.97         0.85        x
8            1.66         1.89         0.88        x
16           2.11         1.91         1.11        x
32           2.33         1.78         1.31        x
64           2.58         1.80         1.43        x

✅ GPU vs CPU对比测试完成!

================================================================================
测试5: 瓶颈识别
================================================================================

5.1 各阶段耗时分析
阶段                   时间(ms)       占比          
--------------------------------------------------
DWT分解                0.897        62.9        %
频域特征提取               0.292        20.5        %
趋势特征提取               0.141        9.9         %
质量特征提取               0.095        6.7         %
难度计算                 0.001        0.1         %
总计                   1.428        100.0       %

✅ 瓶颈识别完成!

================================================================================
测试6: 可扩展性分析
================================================================================

6.1 大规模批处理性能
总样本数            批次大小         时间(ms)       吞吐量(样本/s)      
----------------------------------------------------------------------
128             1            1154.93      110.8          
128             4            51.33        2493.8         
128             8            26.96        4747.0         
128             16           14.67        8727.7         
128             32           8.62         14845.4        
128             64           5.15         24870.5        
128             128          6.51         19666.1        

✅ 可扩展性分析完成!

================================================================================
性能分析总结报告
================================================================================

## 主要发现

### 1. 时间复杂度
   - 序列长度影响: 从128到4096，时间增长约 0.5x
   - 批次大小影响: 批处理效率随批次增大而提升
   - 变量数影响: 线性增长关系

### 2. 空间复杂度
   - 内存使用随序列长度线性增长
   - 典型配置(B=4,N=7,T=512)内存使用: ~0.0MB

### 3. 最优配置
   - 最快小波基: db1 (1.74ms)
   - 最快分解层数: 2 (1.52ms)
   - 推荐压缩级别: balanced (平衡性能和信息量)

### 4. 性能瓶颈
   - 主要瓶颈: DWT分解 (62.9%)
   - 优化建议: 重点优化DWT分解和特征提取并行化

### 5. GPU加速效果
   - 平均加速比: 1.26x
   - GPU加速建议: 批次大小 >= 8 时效果明显

### 6. 可扩展性
   - 最优批次大小: 64 (吞吐量: 24870.5 样本/秒)
   - 建议: 使用中等批次大小(8-32)获得最佳性能

================================================================================

📊 结果已保存到: dwt_performance_results.json

================================================================================
🎉 性能分析完成!